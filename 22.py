print((lambda l:((lambda a:(lambda f,*x:f(f,*x))(lambda g,a: (lambda b,c: a[b<c].extend(sorted([b,c], reverse=True)))(a[0].pop(0), a[1].pop(0)) or g(g,a) if len(a[0]) != 0 and len(a[1]) != 0 else sum([(i+1)*e for i,e in enumerate(a[len(a[0])==0][::-1])]),a))([h[:] for h in l]),(lambda f,r:sum([(i+1)*e for i,e in enumerate(r((False,0,0,l[0],l[1],set()),f,r)[2][::-1])]))(lambda a,b,s,r,f: (True, 0, a) if (t := (tuple(a),tuple(b)))in s or s.add(t) else (True,int(a<b),a+b) if len(a) == 0 or len(b) == 0 else(False, t:=r((False,0,0,a[1:a[0]+1],b[1:b[0]+1],set()),f,r), a0:=a[0], a := a[1:] + [a[0],b[0]]*(not t[1]),b := b[1:] + [b[0],a0]*(t[1]),s) if a[0] < len(a) and b[0] < len(b) else(False,0,a0 := a[0], a := a[1:] + [a[0],b[0]]*(a[0]>b[0]), b := b[1:] + [b[0],a0]*(a0<b[0]),s),lambda h,f,r: any(1 for i in range(1000000000) if (h:=f(h[3],h[4],h[5],r,f)) and h[0]) and h)))(list(map(lambda h: [int(i) for i in h.splitlines() if i.isnumeric()],open("22").read().split("\n\n")))))